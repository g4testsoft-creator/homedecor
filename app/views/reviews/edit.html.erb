<div class="edit-review-container">
  <h2>Edit Your Review</h2>

  <%= form_with(model: [@decor_item, @review], local: true) do |form| %>
    <% if @review.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@review.errors.count, "error") %> prohibited this review from being saved:</h2>
        <ul>
          <% @review.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :rating, "Rating" %>
      <div class="rating-input" id="rating-input">
        <% (1..5).each do |i| %>
          <label class="rating-option">
            <%= form.radio_button :rating, i, class: "rating-radio", checked: @review.rating == i %>
            <span class="star <%= 'highlighted' if i <= @review.rating %>" data-rating="<%= i %>">â˜…</span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="form-group">
      <%= form.label :content, "Your Review" %>
      <%= form.text_area :content, rows: 4, class: "form-control" %>
    </div>

    <div class="form-actions">
      <%= form.submit "Update Review", class: "btn btn-primary" %>
      <%= link_to "Cancel", @decor_item, class: "btn btn-secondary" %>
    </div>
  <% end %>
</div>

<style>
  .edit-review-container {
    max-width: 960px;
    margin: 40px auto;
    padding: 30px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .edit-review-container h2 {
    margin-top: 0;
    color: #333;
  }

  #error_explanation {
    padding: 12px 16px;
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
    border-radius: 6px;
    margin-bottom: 16px;
  }

  #error_explanation h2 {
    font-size: 1rem;
    margin: 0 0 8px 0;
  }

  #error_explanation ul {
    margin: 0;
    padding-left: 20px;
  }

  .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }

  .btn-secondary {
    background: #f0f0f0;
    color: #333;
    border: 1px solid #ddd;
    padding: 10px 18px;
    border-radius: 6px;
    text-decoration: none;
    transition: background 0.2s ease;
  }

  .btn-secondary:hover {
    background: #e0e0e0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ratingInput = document.getElementById('rating-input');
    if (!ratingInput) return;

    const stars = ratingInput.querySelectorAll('.star');
    const radios = ratingInput.querySelectorAll('.rating-radio');

    // Highlight stars on click
    radios.forEach((radio) => {
      radio.addEventListener('change', function() {
        const rating = parseInt(this.value);
        updateStarDisplay(rating);
      });
    });

    // Highlight stars on hover
    stars.forEach((star) => {
      star.addEventListener('mouseenter', function() {
        const rating = parseInt(this.dataset.rating);
        highlightStars(rating);
      });
    });

    // Reset to selected value on mouse leave
    ratingInput.addEventListener('mouseleave', function() {
      const selectedRating = ratingInput.querySelector('input[type="radio"]:checked');
      if (selectedRating) {
        updateStarDisplay(parseInt(selectedRating.value));
      } else {
        clearStars();
      }
    });

    function highlightStars(rating) {
      stars.forEach((star) => {
        const starRating = parseInt(star.dataset.rating);
        if (starRating <= rating) {
          star.classList.add('highlighted');
        } else {
          star.classList.remove('highlighted');
        }
      });
    }

    function updateStarDisplay(rating) {
      highlightStars(rating);
    }

    function clearStars() {
      stars.forEach((star) => {
        star.classList.remove('highlighted');
      });
    }
  });
</script>
